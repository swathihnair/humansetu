---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Tourist Information & Emergency Contacts - Kerala Tourism">
  <div class="min-h-screen relative overflow-hidden">
    <!-- Kerala Themed Background -->
    <div class="fixed inset-0">
      <div 
        class="absolute inset-0 bg-cover bg-center bg-no-repeat"
        style="background-image: url('https://images.unsplash.com/photo-1602216056096-3b40cc0c9944?q=80&w=1920');"
      ></div>
      <div class="absolute inset-0 bg-gradient-to-br from-kerala-green/90 via-kerala-green/70 to-kerala-gold/50"></div>
    </div>
    
    <!-- Main Content -->
    <div class="relative z-10">
      <!-- Header -->
      <header class="bg-black/20 backdrop-blur-xl border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
          <a href="/plan-my-trip" class="text-2xl font-bold text-white hover:scale-105 transition-transform">
            Kerala<span class="text-kerala-gold">Tourism</span>
          </a>
          <div class="flex items-center gap-4">
            <a href="/plan-my-trip" class="px-4 py-2 text-white/80 border border-white/20 rounded-full hover:bg-white/10 transition-all hover:scale-105">
              ‚Üê Back to Plan My Trip
            </a>
          </div>
        </div>
      </header>
      
      <!-- Hero Section -->
      <div class="max-w-7xl mx-auto px-4 py-12">
        <div class="relative mb-12 rounded-3xl overflow-hidden animate-slide-up shadow-2xl">
          <div class="absolute inset-0 bg-gradient-to-r from-blue-500 via-cyan-500 to-blue-500 bg-[length:200%_100%] animate-gradient"></div>
          <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1578662996442-48f60103fc96?q=80&w=1920')] bg-cover bg-center opacity-20"></div>
          
          <div class="relative p-8 md:p-16">
            <div class="text-center">
              <div class="w-24 h-24 bg-white/20 backdrop-blur-md rounded-3xl flex items-center justify-center text-5xl mx-auto mb-6 animate-float">
                üìû
              </div>
              <h1 class="text-4xl md:text-6xl font-bold text-white mb-4">
                Tourist Information & Emergency Contacts
              </h1>
              <p class="text-white/90 text-xl md:text-2xl mb-8">
                Get help when you need it most
              </p>
            </div>
          </div>
        </div>
        
        <!-- Tourist Information Centers Section -->
        <div class="mb-16">
          <div class="flex items-center justify-between mb-8">
            <h2 class="text-3xl font-bold text-white flex items-center gap-3">
              <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-2xl flex items-center justify-center text-2xl">
                ‚ÑπÔ∏è
              </div>
              Tourist Information Centers
            </h2>
            <div class="flex gap-2">
              <button onclick="filterByDistrict('all')" class="filter-btn px-4 py-2 bg-kerala-gold text-white rounded-full text-sm hover:bg-kerala-gold/80 transition-all">
                All Districts
              </button>
              <button onclick="sortByName()" class="px-4 py-2 bg-white/20 text-white rounded-full text-sm hover:bg-white/30 transition-all">
                Sort by Name
              </button>
            </div>
          </div>
          
          <div id="tourist-centers" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Cards will be populated by JavaScript -->
          </div>
        </div>
        
        <!-- Emergency Contacts Section -->
        <div>
          <div class="flex items-center justify-between mb-8">
            <h2 class="text-3xl font-bold text-white flex items-center gap-3">
              <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-pink-600 rounded-2xl flex items-center justify-center text-2xl">
                üö®
              </div>
              Emergency Contacts
            </h2>
            <div class="px-4 py-2 bg-red-500/20 text-red-300 rounded-full text-sm border border-red-500/30">
              24/7 Available
            </div>
          </div>
          
          <div id="emergency-contacts" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Cards will be populated by JavaScript -->
          </div>
        </div>
        
        <!-- Quick Contact Buttons -->
        <div class="mt-16 bg-white/10 backdrop-blur-md rounded-3xl border border-white/20 p-8">
          <h3 class="text-2xl font-bold text-white mb-6 text-center">Quick Emergency Numbers</h3>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <button class="p-4 bg-red-500/20 border border-red-500/30 rounded-xl hover:bg-red-500/30 transition-all text-white text-center">
              <div class="text-2xl mb-2">üöë</div>
              <div class="font-semibold">Ambulance</div>
              <div class="text-lg">108</div>
            </button>
            <button class="p-4 bg-blue-500/20 border border-blue-500/30 rounded-xl hover:bg-blue-500/30 transition-all text-white text-center">
              <div class="text-2xl mb-2">üëÆ</div>
              <div class="font-semibold">Police</div>
              <div class="text-lg">100</div>
            </button>
            <button class="p-4 bg-orange-500/20 border border-orange-500/30 rounded-xl hover:bg-orange-500/30 transition-all text-white text-center">
              <div class="text-2xl mb-2">üî•</div>
              <div class="font-semibold">Fire</div>
              <div class="text-lg">101</div>
            </button>
            <button class="p-4 bg-green-500/20 border border-green-500/30 rounded-xl hover:bg-green-500/30 transition-all text-white text-center">
              <div class="text-2xl mb-2">üö®</div>
              <div class="font-semibold">Disaster</div>
              <div class="text-lg">112</div>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    let touristData = [];
    let emergencyData = [];
    
    // Fetch data from Google Sheets API
    async function fetchData() {
      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbzm29LaHpXECtSaX8b0Z9QHsP8DtZiDhHezWsIcpYg4K5d6NhsZrTqd3ppH2zBeYE7d5Q/exec');
        const data = await response.json();
        
        // Separate data by module
        touristData = data.filter(item => item.Module === 'Tourist Information Center');
        emergencyData = data.filter(item => item.Module === 'Emergency Contact');
        
        // Render the data
        renderTouristCenters();
        renderEmergencyContacts();
      } catch (error) {
        console.error('Error fetching data:', error);
        // Show error message
        document.getElementById('tourist-centers').innerHTML = 
          '<div class="col-span-full text-center text-white/70 p-8">Unable to load data. Please try again later.</div>';
        document.getElementById('emergency-contacts').innerHTML = 
          '<div class="col-span-full text-center text-white/70 p-8">Unable to load data. Please try again later.</div>';
      }
    }
    
    // Format phone number
    function formatPhoneNumber(number) {
      if (typeof number === 'number') {
        const numStr = number.toString();
        if (numStr.length === 12) {
          return `+${numStr.slice(0, 2)} ${numStr.slice(2, 4)} ${numStr.slice(4, 7)} ${numStr.slice(7)}`;
        } else if (numStr.length === 10) {
          return `${numStr.slice(0, 4)} ${numStr.slice(4, 7)} ${numStr.slice(7)}`;
        }
      }
      return number.toString();
    }
    
    // Create contact card HTML
    function createContactCard(item, isEmergency = false) {
      const cardColor = isEmergency 
        ? 'from-red-500/20 to-pink-600/20 border-red-500/30' 
        : 'from-blue-500/20 to-cyan-600/20 border-blue-500/30';
      
      const iconColor = isEmergency 
        ? 'bg-gradient-to-br from-red-500 to-pink-600' 
        : 'bg-gradient-to-br from-blue-500 to-cyan-600';
      
      return `
        <div class="bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 overflow-hidden hover:bg-white/15 transition-all transform hover:scale-105 animate-slide-up contact-card" data-district="${item.District}">
          <div class="p-6">
            <div class="w-12 h-12 ${iconColor} rounded-xl flex items-center justify-center text-2xl mb-4">
              ${isEmergency ? 'üö®' : '‚ÑπÔ∏è'}
            </div>
            <h3 class="text-lg font-bold text-white mb-2 line-clamp-2">${item.Name || 'Contact Center'}</h3>
            <div class="space-y-2">
              <div class="flex items-center gap-2 text-white/80 text-sm">
                <span class="text-base">üìç</span>
                <span class="line-clamp-1">${item.Place || item.District}</span>
              </div>
              <div class="flex items-center gap-2 text-white/80 text-sm">
                <span class="text-base">üèõÔ∏è</span>
                <span class="line-clamp-1">${item.District}</span>
              </div>
              <div class="flex items-center gap-2 text-white/80 text-sm">
                <span class="text-base">üìû</span>
                <a href="tel:${item.Contact}" class="hover:text-kerala-gold transition-colors">
                  ${formatPhoneNumber(item.Contact)}
                </a>
              </div>
            </div>
            <button onclick="callNumber('${item.Contact}')" class="mt-4 w-full py-2 bg-kerala-gold text-white rounded-lg hover:bg-kerala-gold/80 transition-all text-sm font-semibold">
              Call Now
            </button>
          </div>
        </div>
      `;
    }
    
    // Render tourist centers
    function renderTouristCenters(data = touristData) {
      const container = document.getElementById('tourist-centers');
      if (data.length === 0) {
        container.innerHTML = '<div class="col-span-full text-center text-white/70 p-8">No tourist information centers found.</div>';
        return;
      }
      
      container.innerHTML = data.map(item => createContactCard(item, false)).join('');
    }
    
    // Render emergency contacts
    function renderEmergencyContacts() {
      const container = document.getElementById('emergency-contacts');
      if (emergencyData.length === 0) {
        container.innerHTML = '<div class="col-span-full text-center text-white/70 p-8">No emergency contacts found.</div>';
        return;
      }
      
      container.innerHTML = emergencyData.map(item => createContactCard(item, true)).join('');
    }
    
    // Filter by district
    function filterByDistrict(district) {
      if (district === 'all') {
        renderTouristCenters();
        document.querySelectorAll('.filter-btn').forEach(btn => {
          btn.classList.remove('bg-kerala-gold');
          btn.classList.add('bg-white/20');
        });
        event.target.classList.remove('bg-white/20');
        event.target.classList.add('bg-kerala-gold');
      } else {
        const filtered = touristData.filter(item => item.District.toLowerCase() === district.toLowerCase());
        renderTouristCenters(filtered);
      }
    }
    
    // Sort by name
    function sortByName() {
      const sorted = [...touristData].sort((a, b) => (a.Name || '').localeCompare(b.Name || ''));
      renderTouristCenters(sorted);
    }
    
    // Call number function
    function callNumber(number) {
      window.location.href = `tel:${number}`;
    }
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', fetchData);
  </script>
</Layout>

<style>
  @keyframes slideUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  @keyframes gradient {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  
  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-20px); }
  }
  
  .animate-slide-up { animation: slideUp 0.6s ease-out forwards; opacity: 0; }
  .animate-gradient { animation: gradient 3s ease infinite; }
  .animate-float { animation: float 4s ease-in-out infinite; }
  
  .contact-card:nth-child(1) { animation-delay: 100ms; }
  .contact-card:nth-child(2) { animation-delay: 200ms; }
  .contact-card:nth-child(3) { animation-delay: 300ms; }
  .contact-card:nth-child(4) { animation-delay: 400ms; }
  .contact-card:nth-child(5) { animation-delay: 500ms; }
  .contact-card:nth-child(6) { animation-delay: 600ms; }
  .contact-card:nth-child(7) { animation-delay: 700ms; }
  .contact-card:nth-child(8) { animation-delay: 800ms; }
  
  .line-clamp-1 {
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
  }
  
  .line-clamp-2 {
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
</style>
